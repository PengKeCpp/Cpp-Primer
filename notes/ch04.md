# 第四章 表达式



## 4.1 表达式基础

**重载运算符**：当运算符作用在类类型的运算对象时，用户可以自行定义其含义。

**运算对象转换：**小整数类型(bool、short、char等)通常会被提升成较大的整数类型，主要是int。

**左值和右值**：

- C中原意：左值**可以**在表达式左边，右值不能。
- `C++`：当一个对象被用作**右值**的时候，用的是对象的**值**（内容）；
- 被用做**左值**时，用的是对象的**身份**（在内存中的位置）。

**求值顺序：**对于那些没有指定执行顺序的运算符来说，如果表达式指向并修改了同一对象，将会引发错误并产生未定义的行为。

**建议：**如果改变了某个运算对象的值，在其他地方不要再使用这个运算对象。



## 4.2 算术运算符

**溢出**：当计算的结果超出该类型所能表示的范围时就会产生溢出。很多系统再编译和运行时都不报溢出错误。

**在C++11中：m%n的符号与m相同。**

## 4.3 逻辑运算符

- **短路求值**：逻辑与运算符和逻辑或运算符都是先求左侧运算对象的值再求右侧运算对象的值，当且仅当左侧运算对象无法确定表达式的结果时才会计算右侧运算对象的值。

## 4.4 赋值运算符

- 如果赋值运算的左右侧运算对象类型不同，则右侧运算对象将转换成左侧运算对象的类型。
- 赋值运算符满足右结合律，这点和其他二元运算符不一样。 `ival = jval = 0;`等价于`ival = (jval = 0);`
- **赋值运算优先级比较低。**
- 因为赋值运算符的优先级低于关系运算符的优先级，所以在条件语句中，赋值部分通常应该加上括号。
- 赋值运算符的左侧运算对象必须是一个**可修改的左值**。



## 条件运算符

- 条件运算符（`?:`）允许我们把简单的`if-else`逻辑嵌入到单个表达式中去，按照如下形式：`cond? expr1: expr2`

## 位运算符

- 位运算符是作用于**整数类型**的运算对象。
- 二进制位向左移（`<<`）或者向右移（`>>`），移出边界外的位就被舍弃掉了。
- 位取反（`~`）、与（`&`）、或（`|`）、异或（`^`）

## sizeof运算符

- 返回一条表达式或一个类型名字所占的**字节数**。返回的类型是 `size_t`。
- 两种形式： `sizeof (type)`和 `sizeof expr`

## 类型转换

### 隐式类型转换

- 比 `int`类型小的整数值先提升为较大的整数类型。
- 条件中，非布尔转换成布尔。
- 初始化中，初始值转换成变量的类型。
- 算术运算或者关系运算的运算对象有多种类型，要转换成同一种类型。
- 函数调用时。

### 显式类型转换（尽量避免）

- **static_cast**：任何明确定义的类型转换，只要不包含底层const，都可以使用。 `double slope = static_cast<double>(j);`
- **dynamic_cast**：支持运行时类型识别。
- **const_cast**：只能改变运算对象的底层const，一般可用于去除const性质。 `const char *pc; char *p = const_cast<char*>(pc)`
- **reinterpret_cast**：通常为运算对象的位模式提供低层次上的重新解释。
